<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="../static/js/fabric.js"></script>
    <script src="../static/js/jquery-3.3.1.js"></script>
    <script src="../static/js/extend-fabric.js"></script>
</head>
<body>
    <canvas id="c" width="600" height="600"></canvas>
</body>

<script>
    var circleCount = 1;
    var lineCount = 0;
    var MAX_INF = Number.MAX_VALUE;

    var matrix = [];
    var line = [];

    for(var i = 0; i < 7; i++) {        //一维长度为3
        matrix[i] = [];
        for(var j = 0; j < 7; j++) {    //二维长度为5
            matrix[i][j] = MAX_INF;
        }
    }

    var value = [];
    for(var k = 0; k < 6; k++) {
        value[k] = Math.round(Math.random() * 60)
    }

    matrix[0][1] = value[0];
    matrix[1][2] = value[1];
    matrix[1][5] = value[4];
    matrix[1][6] = value[5];
    matrix[2][3] = value[2];
    matrix[2][4] = value[3];

    function makeCircle(left, top, line1, line2, line3, line4) {
        var c = new fabric.Circle({
            strokeWidth: 5,
            radius: 12,
            fill: '#fff',
            stroke: '#666',
            originX: 'center',
            originY: 'center',
            hasControls: false,
            hasBorders: false
        });

        var t = new fabric.Text(String(circleCount++), {
            fontSize: 14,
            originX: 'center',
            originY: 'center'
        });

        var g = new fabric.Group([c, t], {
            left: left,
            top: top,
            hasControls: false,
            hasBorders: false
            //selectable: false
        });

        g.line1 = line1;
        g.line2 = line2;
        g.line3 = line3;
        g.line4 = line4;
        return g;
    }

    function makeLine(coords) {
        return new fabric.LineArrow(coords, {
            fill: 'red',
            stroke: 'red',
            strokeWidth: 5,
            label: String(value[lineCount++]),
            selectable: false
        });
    }

    $(function () {
        var canvas = this.__canvas = new fabric.Canvas('c', { selection: false });

        fabric.Object.prototype.originX = fabric.Object.prototype.originY = 'center';

        line[0] = makeLine([ 50, 50, 270, 60 ]);
        line[1] = makeLine([ 270, 60, 250, 250 ]);
        line[2] = makeLine([ 250, 250, 350, 440]);
        line[3] = makeLine([ 250, 250, 80, 440]);
        line[4] = makeLine([ 270, 60, 75, 225 ]);
        line[5] = makeLine([ 270, 60, 375, 225 ]);

        canvas.add(line[0], line[1], line[2], line[3], line[4], line[5]);

        var circle = makeCircle(line[0].get('x1'), line[0].get('y1'), null, line[0]),
            circle2 = makeCircle(line[0].get('x2'), line[0].get('y2'), line[0], line[1], line[4], line[5]),
            circle3 = makeCircle(line[1].get('x2'), line[1].get('y2'), line[1], line[2], line[3]),
            circle4 = makeCircle(line[2].get('x2'), line[2].get('y2'), line[2]),
            circle5 = makeCircle(line[3].get('x2'), line[3].get('y2'), line[3]),
            circle6 = makeCircle(line[4].get('x2'), line[4].get('y2'), line[4]),
            circle7 = makeCircle(line[5].get('x2'), line[5].get('y2'), line[5]);

        canvas.add(circle, circle2, circle3, circle4, circle5, circle6, circle7);

        canvas.on('object:moving', function(e) {
            var p = e.target;

            p.line1 && p.line1.set({ 'x2': p.left, 'y2': p.top });
            p.line2 && p.line2.set({ 'x1': p.left, 'y1': p.top });
            p.line3 && p.line3.set({ 'x1': p.left, 'y1': p.top });
            p.line4 && p.line4.set({ 'x1': p.left, 'y1': p.top });

            //changeLine(p);
            canvas.renderAll();
        });




    })

</script>

<script type="text/javascript">

</script>
</html>